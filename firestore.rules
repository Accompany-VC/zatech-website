rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /anonymous_reports/{reportId} {
      allow create: if isValidReportData();
      allow read, update, delete: if isAdmin();
    }
    
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

function isValidReportData() {
  let data = request.resource.data;
  return data.keys().hasAll(['report_type', 'description', 'status']) &&
         data.report_type is string &&
         data.report_type in ['harassment', 'discrimination', 'inappropriate_content', 
                             'spam', 'violence', 'hate_speech', 'other'] &&
         data.description is string &&
         data.description.size() >= 10 &&
         data.description.size() <= 1000 &&
         data.status == 'pending';
}

function isAdmin() {
  return request.auth != null && request.auth.token.admin == true;
}